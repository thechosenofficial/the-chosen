<script>
    const canvas = document.getElementById('warpCanvas');
    const ctx = canvas.getContext('2d');
    const btn = document.getElementById('enter-btn');

    let width, height, stars = [];
    // 모바일은 사양이 낮을 수 있으므로 입자 수를 기기 사양에 맞춤
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    const count = isMobile ? 300 : 600; 

    const baseSpeed = 0.05;  // 더 천천히 다가오게 수정 (어지러움 방지)
    const warpSpeed = 8.0;   
    let speed = baseSpeed;
    let targetSpeed = baseSpeed;

    const colors = ['#FFFFFF', '#A5C9E1', '#E1F5FE'];

    class Star {
        constructor(isInitial = false) { this.reset(isInitial); }
        reset(isInitial = false) {
            this.x = (Math.random() - 0.5) * width;
            this.y = (Math.random() - 0.5) * height;
            this.z = isInitial ? Math.random() * width : width;
            this.pz = this.z + 40; 
            this.color = colors[Math.floor(Math.random() * colors.length)];
            this.size = Math.random() * 1.2 + 0.3;
        }
        update() {
            this.z -= speed * 70;
            if (this.z < 1) this.reset();
        }
        show() {
            let sx = (this.x / this.z) * (width / 2) + width / 2;
            let sy = (this.y / this.z) * (height / 2) + height / 2;
            let px = (this.x / this.pz) * (width / 2) + width / 2;
            let py = (this.y / this.pz) * (height / 2) + height / 2;

            ctx.beginPath();
            ctx.moveTo(px, py);
            ctx.lineTo(sx, sy);
            ctx.strokeStyle = this.color;
            ctx.lineWidth = this.size * (1 - this.z / width);
            ctx.lineCap = 'round';
            ctx.stroke();
            this.pz = this.z;
        }
    }

    function init() {
        const dpr = window.devicePixelRatio || 1;
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width * dpr;
        canvas.height = height * dpr;
        canvas.style.width = `${width}px`;
        canvas.style.height = `${height}px`;
        ctx.scale(dpr, dpr);
        stars = [];
        for (let i = 0; i < count; i++) stars.push(new Star(true));
    }

    function draw() {
        // 배경 투명도를 조절해 모바일 잔상 최적화
        ctx.fillStyle = 'rgba(5, 8, 10, 0.3)';
        ctx.fillRect(0, 0, width, height);
        speed += (targetSpeed - speed) * 0.04;
        stars.forEach(star => { star.update(); star.show(); });
        requestAnimationFrame(draw);
    }

    const startWarp = () => targetSpeed = warpSpeed;
    const stopWarp = () => targetSpeed = baseSpeed;

    btn.addEventListener('mousedown', startWarp);
    btn.addEventListener('mouseup', stopWarp);
    btn.addEventListener('touchstart', (e) => { e.preventDefault(); startWarp(); });
    btn.addEventListener('touchend', stopWarp);
    window.addEventListener('resize', init);

    init();
    draw();
</script>
